---
import { t, type Locale } from "@/lib/i18n";
import LocaleSwitcher from "./LocaleSwitcher.astro";
const { lang } = Astro.props as { lang: Locale };
---
<header class="container flex items-center justify-between py-6">
  <a href={`/${lang}`} class="flex items-center gap-2">
    <img src="/logo.svg" alt="zhouzhiou" width="28" height="28"/>
    <span class="sr-only">Home</span>
  </a>
  <nav class="hidden md:flex items-center gap-8 text-sm text-[var(--color-muted)]">
    <a href={`/${lang}`}>{t('common','nav_home', lang)}</a>
    <a href={`/${lang}/blog`}>{t('common','nav_blog', lang)}</a>
    <a href={`/${lang}/projects`}>{t('common','nav_projects', lang)}</a>
    <a href={`/${lang}/notes`}>{t('common','nav_notes', lang)}</a>
    <a href={`/${lang}/about`}>{t('common','nav_about', lang)}</a>
    <a href={`/${lang}/contact`}>{t('common','nav_contact', lang)}</a>

    <!-- Right side icons -->
    <button aria-label="Search" class="text-lg hover:text-white">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    </button>
    <LocaleSwitcher lang={lang} path={Astro.url.pathname} />
    <button aria-label="Toggle Theme" id="theme-toggle" class="text-lg hover:text-white flex items-center justify-center w-6 h-6">
      <!-- Sun icon -->
      <svg id="icon-sun" class="hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 6.95l-1.414-1.414M6.464 6.464 5.05 5.05m12.9 0-1.414 1.414M6.464 17.536 5.05 18.95"/></svg>
      <!-- Moon icon -->
      <svg id="icon-moon" class="hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1019 12.79z"/></svg>
    </button>
  </nav>

  <script>
    const themeKey = 'theme';
    const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
    const stored = localStorage.getItem(themeKey);
    const html = document.documentElement;
    const btn = document.getElementById('theme-toggle');
    const sun = document.getElementById('icon-sun');
    const moon = document.getElementById('icon-moon');

    // Apply theme early to avoid FOUC
    if(!stored){
      // if no stored preference and system is light, ensure html has no dark at start
      if(prefersLight) html.classList.remove('dark');
    }

    function setTheme(t){
      if(t === 'light'){
        html.classList.remove('dark');
        sun?.classList.add('hidden');
        moon?.classList.remove('hidden');
      }else{
        html.classList.add('dark');
        moon?.classList.add('hidden');
        sun?.classList.remove('hidden');
      }
    }

    const initial = stored ?? 'dark';
    setTheme(initial);

    btn?.addEventListener('click', ()=>{
      const next = html.classList.contains('dark') ? 'light':'dark';
      localStorage.setItem(themeKey, next);
      setTheme(next);
    });
  </script>

